# å¦‚ä½•å®ç°æ•°æ®æŒä¹…åŒ–åˆ° volumesï¼Ÿ

## ğŸ”‘ å…³é”®é…ç½®ï¼šdocker-compose.yml ä¸­çš„ volumes

### æ ¸å¿ƒé…ç½®ä»£ç 

åœ¨ `docker-compose.yml` æ–‡ä»¶ä¸­ï¼Œæˆ‘ä¸ºæ¯ä¸ªæœåŠ¡é…ç½®äº† `volumes` æ˜ å°„ï¼š

```yaml
services:
  etcd:
    volumes:
      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/etcd:/etcd
      #   â†‘ å®¿ä¸»æœºè·¯å¾„                    â†‘ å®¹å™¨å†…è·¯å¾„
  
  minio:
    volumes:
      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/minio:/minio_data
  
  standalone:
    volumes:
      - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/milvus:/var/lib/milvus
```

## ğŸ“‹ é…ç½®è§£æ

### æ ¼å¼è¯´æ˜

```yaml
volumes:
  - å®¿ä¸»æœºè·¯å¾„:å®¹å™¨å†…è·¯å¾„
```

- **å·¦ä¾§**ï¼šå®¿ä¸»æœºï¼ˆä½ çš„ç”µè„‘ï¼‰ä¸Šçš„ç›®å½•è·¯å¾„
- **å³ä¾§**ï¼šå®¹å™¨å†…çš„ç›®å½•è·¯å¾„
- **å†’å· `:`**ï¼šåˆ†éš”ç¬¦ï¼Œè¡¨ç¤º"æ˜ å°„åˆ°"

### å®é™…æ˜ å°„å…³ç³»

| æœåŠ¡ | å®¿ä¸»æœºè·¯å¾„ | å®¹å™¨å†…è·¯å¾„ | è¯´æ˜ |
|------|-----------|-----------|------|
| etcd | `./volumes/etcd` | `/etcd` | etcd æ•°æ®ç›®å½•æ˜ å°„ |
| minio | `./volumes/minio` | `/minio_data` | MinIO æ•°æ®ç›®å½•æ˜ å°„ |
| milvus | `./volumes/milvus` | `/var/lib/milvus` | Milvus æ•°æ®ç›®å½•æ˜ å°„ |

## ğŸ”§ Docker å¦‚ä½•å®ç°æŒä¹…åŒ–ï¼Ÿ

### 1. Bind Mountï¼ˆç»‘å®šæŒ‚è½½ï¼‰æœºåˆ¶

å½“ Docker å®¹å™¨å¯åŠ¨æ—¶ï¼ŒDocker ä¼šï¼š

```
1. æ£€æŸ¥å®¿ä¸»æœºè·¯å¾„æ˜¯å¦å­˜åœ¨
   â†“ ä¸å­˜åœ¨åˆ™åˆ›å»º
2. å°†å®¿ä¸»æœºç›®å½•"æŒ‚è½½"åˆ°å®¹å™¨å†…æŒ‡å®šè·¯å¾„
   â†“
3. å®¹å™¨å†…å¯¹è¯¥è·¯å¾„çš„è¯»å†™æ“ä½œ
   â†“
4. ç›´æ¥æ˜ å°„åˆ°å®¿ä¸»æœºçš„å®é™…æ–‡ä»¶ç³»ç»Ÿ
```

### 2. å®é™…éªŒè¯

æŸ¥çœ‹å®¹å™¨æŒ‚è½½ä¿¡æ¯ï¼š

```bash
docker inspect milvus-standalone | grep -A 10 "Mounts"
```

è¾“å‡ºç¤ºä¾‹ï¼š
```json
"Mounts": [
    {
        "Type": "bind",                    â† ç»‘å®šæŒ‚è½½ç±»å‹
        "Source": "/Users/admin/.../volumes/milvus",  â† å®¿ä¸»æœºè·¯å¾„
        "Destination": "/var/lib/milvus",  â† å®¹å™¨å†…è·¯å¾„
        "Mode": "rw",                      â† è¯»å†™æ¨¡å¼
        "RW": true
    }
]
```

## ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·å°±èƒ½æŒä¹…åŒ–ï¼Ÿ

### å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¹å™¨å†…å†™å…¥æ“ä½œ                           â”‚
â”‚  Milvus å†™å…¥ /var/lib/milvus/data       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ Docker Bind Mount
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®é™…å†™å…¥å®¿ä¸»æœº                          â”‚
â”‚  /Users/admin/.../volumes/milvus/data   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç‚¹

1. **ä¸æ˜¯å¤åˆ¶ï¼Œæ˜¯æ˜ å°„**
   - å®¹å™¨å†…çš„ç›®å½•**ç›´æ¥æŒ‡å‘**å®¿ä¸»æœºçš„ç›®å½•
   - æ²¡æœ‰æ•°æ®å¤åˆ¶è¿‡ç¨‹
   - ç±»ä¼¼ Linux çš„ `mount --bind`

2. **å®æ—¶åŒæ­¥**
   - å®¹å™¨å†…å†™å…¥ â†’ ç«‹å³å†™å…¥å®¿ä¸»æœº
   - å®¿ä¸»æœºä¿®æ”¹ â†’ å®¹å™¨å†…å¯è§
   - å®Œå…¨åŒæ­¥ï¼Œæ— å»¶è¿Ÿ

3. **ç‹¬ç«‹äºå®¹å™¨ç”Ÿå‘½å‘¨æœŸ**
   - å®¹å™¨åˆ é™¤ â†’ å®¿ä¸»æœºç›®å½•ä¿ç•™ âœ…
   - å®¹å™¨é‡å¯ â†’ é‡æ–°æŒ‚è½½ï¼Œæ•°æ®æ¢å¤ âœ…
   - åªæœ‰åˆ é™¤å®¿ä¸»æœºç›®å½•æ‰ä¼šä¸¢å¤±æ•°æ® âŒ

## ğŸ¯ å…·ä½“åšäº†ä»€ä¹ˆï¼Ÿ

### æ­¥éª¤1ï¼šåˆ›å»º docker-compose.yml

é…ç½®äº† volumes æ˜ å°„ï¼š

```yaml
volumes:
  - ./volumes/etcd:/etcd
  - ./volumes/minio:/minio_data
  - ./volumes/milvus:/var/lib/milvus
```

### æ­¥éª¤2ï¼šå¯åŠ¨å®¹å™¨

```bash
docker-compose up -d
```

Docker è‡ªåŠ¨æ‰§è¡Œï¼š
1. åˆ›å»º `./volumes/etcd`ã€`./volumes/minio`ã€`./volumes/milvus` ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
2. å°†è¿™äº›ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„å¯¹åº”è·¯å¾„
3. å®¹å™¨å†…çš„æ•°æ®å†™å…¥æ“ä½œç›´æ¥å†™å…¥å®¿ä¸»æœºç›®å½•

### æ­¥éª¤3ï¼šæ•°æ®å†™å…¥

å½“ Milvus å†™å…¥æ•°æ®æ—¶ï¼š

```python
client.insert(collection_name="demo_collection", data=data)
```

æ•°æ®æµå‘ï¼š
```
Milvus å®¹å™¨
  â†“ å†™å…¥ /var/lib/milvus
  â†“ Docker Bind Mount
å®¿ä¸»æœº
  â†“ å®é™…å†™å…¥ ./volumes/milvus
  â†“ æŒä¹…åŒ–åˆ°ç£ç›˜ âœ…
```

## ğŸ“Š éªŒè¯æŒä¹…åŒ–

### æ–¹æ³•1ï¼šæŸ¥çœ‹å®¿ä¸»æœºç›®å½•

```bash
ls -lh volumes/
# å¯ä»¥çœ‹åˆ°æ•°æ®æ–‡ä»¶
```

### æ–¹æ³•2ï¼šåœæ­¢å®¹å™¨åæ£€æŸ¥

```bash
docker-compose down
ls -lh volumes/
# æ•°æ®ä»ç„¶å­˜åœ¨ âœ…
```

### æ–¹æ³•3ï¼šé‡å¯å®¹å™¨åæŸ¥è¯¢

```bash
docker-compose up -d
python search_milvus.py
# æ•°æ®å¯ä»¥æŸ¥è¯¢åˆ° âœ…
```

## ğŸ” å¯¹æ¯”ï¼šæ²¡æœ‰ volumes çš„æƒ…å†µ

### æ²¡æœ‰é…ç½® volumes

```yaml
# æ²¡æœ‰ volumes é…ç½®
services:
  standalone:
    # volumes: []  â† æ²¡æœ‰é…ç½®
```

ç»“æœï¼š
- æ•°æ®å­˜å‚¨åœ¨å®¹å™¨å†…çš„æ–‡ä»¶ç³»ç»Ÿ
- å®¹å™¨åˆ é™¤ â†’ æ•°æ®ä¸¢å¤± âŒ
- å®¹å™¨é‡å¯ â†’ æ•°æ®å¯èƒ½ä¸¢å¤± âŒ

### é…ç½®äº† volumes

```yaml
services:
  standalone:
    volumes:
      - ./volumes/milvus:/var/lib/milvus  â† é…ç½®äº†æ˜ å°„
```

ç»“æœï¼š
- æ•°æ®å­˜å‚¨åœ¨å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿ
- å®¹å™¨åˆ é™¤ â†’ æ•°æ®ä¿ç•™ âœ…
- å®¹å™¨é‡å¯ â†’ æ•°æ®æ¢å¤ âœ…

## ğŸ“ æ€»ç»“

### å®ç°æŒä¹…åŒ–çš„å…³é”®æ­¥éª¤

1. âœ… **é…ç½® volumes æ˜ å°„**ï¼ˆåœ¨ docker-compose.yml ä¸­ï¼‰
   ```yaml
   volumes:
     - ./volumes/etcd:/etcd
   ```

2. âœ… **Docker è‡ªåŠ¨åˆ›å»ºå’ŒæŒ‚è½½**
   - Docker è‡ªåŠ¨åˆ›å»ºå®¿ä¸»æœºç›®å½•
   - Docker è‡ªåŠ¨æŒ‚è½½åˆ°å®¹å™¨å†…è·¯å¾„

3. âœ… **æ•°æ®è‡ªåŠ¨æŒä¹…åŒ–**
   - å®¹å™¨å†…å†™å…¥ â†’ è‡ªåŠ¨å†™å…¥å®¿ä¸»æœº
   - æ— éœ€é¢å¤–æ“ä½œ

### æ ¸å¿ƒæœºåˆ¶

- **Bind Mount**ï¼šå°†å®¿ä¸»æœºç›®å½•ç›´æ¥æ˜ å°„åˆ°å®¹å™¨å†…ç›®å½•
- **å®æ—¶åŒæ­¥**ï¼šå†™å…¥æ“ä½œç«‹å³åæ˜ åˆ°å®¿ä¸»æœº
- **ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹**ï¼šæ•°æ®ç‹¬ç«‹äºå®¹å™¨å­˜åœ¨

### ä¸€å¥è¯æ€»ç»“

**é€šè¿‡åœ¨ docker-compose.yml ä¸­é…ç½® `volumes` æ˜ å°„ï¼ŒDocker ä¼šè‡ªåŠ¨å°†å®¹å™¨å†…çš„æ•°æ®ç›®å½•æ˜ å°„åˆ°å®¿ä¸»æœºçš„ volumes ç›®å½•ï¼Œå®ç°æ•°æ®æŒä¹…åŒ–ã€‚**

