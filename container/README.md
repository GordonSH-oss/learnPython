# Docker å’Œ Kubernetes å®Œæ•´æ•™ç¨‹æ¡ˆä¾‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Docker å’Œ Kubernetes å­¦ä¹ æ¡ˆä¾‹ï¼ŒåŒ…å«ä¸€ä¸ªç®€å•çš„ Flask Web åº”ç”¨ã€‚

> ğŸ’¡ **æƒ³äº†è§£ Docker å’Œ Kubernetes çš„å…³ç³»ï¼Ÿ** æŸ¥çœ‹ [DOCKER_K8S_RELATIONSHIP.md](./DOCKER_K8S_RELATIONSHIP.md)

## ğŸ“ é¡¹ç›®ç»“æ„

```
container/
â”œâ”€â”€ app.py                 # Flask åº”ç”¨
â”œâ”€â”€ requirements.txt       # Python ä¾èµ–
â”œâ”€â”€ Dockerfile            # Docker é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ .dockerignore         # Docker æ„å»ºå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ docker-compose.yml    # Docker Compose é…ç½®
â”œâ”€â”€ k8s/                  # Kubernetes é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ deployment.yaml   # Deployment é…ç½®
â”‚   â”œâ”€â”€ service.yaml      # Service é…ç½®
â”‚   â””â”€â”€ ingress.yaml      # Ingress é…ç½®ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ README.md            # æœ¬æ–‡ä»¶
```

---

## ğŸ³ Docker éƒ¨åˆ†

### 1. æ„å»º Docker é•œåƒ

```bash
# åœ¨ container ç›®å½•ä¸‹æ‰§è¡Œ
docker build -t flask-app:latest .
```

**è¯´æ˜ï¼š**
- `-t flask-app:latest`: ç»™é•œåƒæ‰“æ ‡ç­¾ï¼Œåç§°ä¸º `flask-app`ï¼Œç‰ˆæœ¬ä¸º `latest`
- `.`: ä½¿ç”¨å½“å‰ç›®å½•ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡

### 2. æŸ¥çœ‹æ„å»ºçš„é•œåƒ

```bash
docker images | grep flask-app
```

### 3. è¿è¡Œ Docker å®¹å™¨

#### æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œ

```bash
docker run -d \
  --name flask-app \
  -p 5000:5000 \
  -e ENVIRONMENT=development \
  flask-app:latest
```

**å‚æ•°è¯´æ˜ï¼š**
- `-d`: åå°è¿è¡Œï¼ˆdetached modeï¼‰
- `--name flask-app`: å®¹å™¨åç§°
- `-p 5000:5000`: ç«¯å£æ˜ å°„ï¼ˆä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ï¼‰
- `-e ENVIRONMENT=development`: è®¾ç½®ç¯å¢ƒå˜é‡

#### æ–¹å¼äºŒï¼šä½¿ç”¨ Docker Compose

```bash
# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down
```

### 4. æµ‹è¯•åº”ç”¨

```bash
# è®¿é—®ä¸»é¡µ
curl http://localhost:5000

# å¥åº·æ£€æŸ¥
curl http://localhost:5000/health

# æŸ¥çœ‹ä¿¡æ¯
curl http://localhost:5000/info
```

### 5. å¸¸ç”¨ Docker å‘½ä»¤

```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬åœæ­¢çš„ï¼‰
docker ps -a

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs flask-app
docker logs -f flask-app  # å®æ—¶è·Ÿè¸ªæ—¥å¿—

# è¿›å…¥å®¹å™¨å†…éƒ¨
docker exec -it flask-app /bin/bash

# åœæ­¢å®¹å™¨
docker stop flask-app

# åˆ é™¤å®¹å™¨
docker rm flask-app

# åˆ é™¤é•œåƒ
docker rmi flask-app:latest

# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µ
docker stats flask-app
```

---

## â˜¸ï¸ Kubernetes éƒ¨åˆ†

### å‰ç½®è¦æ±‚

1. **å®‰è£… Kubernetes**
   - æœ¬åœ°å¼€å‘ï¼šä½¿ç”¨ Minikube æˆ– Docker Desktopï¼ˆå†…ç½® Kubernetesï¼‰
   - ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨äº‘æœåŠ¡å•†çš„ Kubernetesï¼ˆå¦‚ GKEã€EKSã€AKSï¼‰

2. **å®‰è£… kubectl**
   ```bash
   # macOS
   brew install kubectl
   
   # éªŒè¯å®‰è£…
   kubectl version --client
   ```

### 1. å‡†å¤‡é•œåƒ

#### é€‰é¡¹ Aï¼šä½¿ç”¨æœ¬åœ°é•œåƒï¼ˆMinikubeï¼‰

```bash
# å¦‚æœä½¿ç”¨ Minikubeï¼Œéœ€è¦å°†é•œåƒåŠ è½½åˆ° Minikube
minikube image load flask-app:latest

# æˆ–è€…ä½¿ç”¨ Minikube çš„ Docker ç¯å¢ƒæ„å»º
eval $(minikube docker-env)
docker build -t flask-app:latest .
eval $(minikube docker-env -u)
```

#### é€‰é¡¹ Bï¼šæ¨é€åˆ°é•œåƒä»“åº“ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

```bash
# ç™»å½•åˆ° Docker Hubï¼ˆæˆ–å…¶ä»–é•œåƒä»“åº“ï¼‰
docker login

# æ ‡è®°é•œåƒ
docker tag flask-app:latest your-username/flask-app:latest

# æ¨é€é•œåƒ
docker push your-username/flask-app:latest

# ç„¶åä¿®æ”¹ k8s/deployment.yaml ä¸­çš„ image å­—æ®µ
```

### 2. éƒ¨ç½²åˆ° Kubernetes

#### æ­¥éª¤ 1ï¼šåˆ›å»º Deployment

```bash
kubectl apply -f k8s/deployment.yaml
```

**æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€ï¼š**
```bash
# æŸ¥çœ‹ Deployment
kubectl get deployments

# æŸ¥çœ‹ Pods
kubectl get pods -l app=flask-app

# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name>

# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs -f <pod-name>
kubectl logs -f -l app=flask-app  # æŸ¥çœ‹æ‰€æœ‰åŒ¹é…æ ‡ç­¾çš„ Pod æ—¥å¿—
```

#### æ­¥éª¤ 2ï¼šåˆ›å»º Service

```bash
kubectl apply -f k8s/service.yaml
```

**æŸ¥çœ‹ Serviceï¼š**
```bash
kubectl get services
kubectl describe service flask-app-service
```

#### æ­¥éª¤ 3ï¼šè®¿é—®åº”ç”¨

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ NodePortï¼ˆå·²é…ç½®ï¼‰**

```bash
# è·å–èŠ‚ç‚¹ IPï¼ˆMinikubeï¼‰
minikube ip

# è®¿é—®åº”ç”¨ï¼ˆæ›¿æ¢ <node-ip> ä¸ºå®é™… IPï¼‰
curl http://<node-ip>:30080

# æˆ–è€…ä½¿ç”¨ Minikube çš„ service å‘½ä»¤
minikube service flask-app-service
```

**æ–¹å¼äºŒï¼šä½¿ç”¨ Port Forwardï¼ˆä¸´æ—¶è®¿é—®ï¼‰**

```bash
kubectl port-forward service/flask-app-service 8080:80

# ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯è®¿é—®
curl http://localhost:8080
```

**æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Ingressï¼ˆéœ€è¦å®‰è£… Ingress Controllerï¼‰**

```bash
# å®‰è£… Nginx Ingress Controllerï¼ˆMinikubeï¼‰
minikube addons enable ingress

# åˆ›å»º Ingress
kubectl apply -f k8s/ingress.yaml

# æŸ¥çœ‹ Ingress
kubectl get ingress

# æ·»åŠ  hosts æ¡ç›®ï¼ˆæœ¬åœ°å¼€å‘ï¼‰
echo "$(minikube ip) flask-app.local" | sudo tee -a /etc/hosts

# è®¿é—®
curl http://flask-app.local
```

### 3. å¸¸ç”¨ Kubernetes å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰èµ„æº
kubectl get all

# æŸ¥çœ‹å‘½åç©ºé—´
kubectl get namespaces
kubectl get ns

# åœ¨æŒ‡å®šå‘½åç©ºé—´éƒ¨ç½²
kubectl apply -f k8s/deployment.yaml -n <namespace>

# æ‰©å±• Deploymentï¼ˆå¢åŠ å‰¯æœ¬æ•°ï¼‰
kubectl scale deployment flask-app --replicas=5

# æ»šåŠ¨æ›´æ–°
kubectl set image deployment/flask-app flask-app=flask-app:v2.0

# æŸ¥çœ‹æ›´æ–°å†å²
kubectl rollout history deployment/flask-app

# å›æ»š
kubectl rollout undo deployment/flask-app

# åˆ é™¤èµ„æº
kubectl delete -f k8s/deployment.yaml
kubectl delete -f k8s/service.yaml

# å¼ºåˆ¶åˆ é™¤ Pod
kubectl delete pod <pod-name> --force --grace-period=0
```

### 4. ç›‘æ§å’Œè°ƒè¯•

```bash
# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name>

# æŸ¥çœ‹äº‹ä»¶
kubectl get events --sort-by=.metadata.creationTimestamp

# è¿›å…¥ Pod å®¹å™¨
kubectl exec -it <pod-name> -- /bin/bash

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
kubectl top pods
kubectl top nodes
```

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

### Docker å·¥ä½œæµç¨‹

```bash
# 1. æ„å»ºé•œåƒ
docker build -t flask-app:latest .

# 2. è¿è¡Œå®¹å™¨
docker run -d -p 5000:5000 --name flask-app flask-app:latest

# 3. æµ‹è¯•
curl http://localhost:5000

# 4. æŸ¥çœ‹æ—¥å¿—
docker logs flask-app

# 5. åœæ­¢å¹¶åˆ é™¤
docker stop flask-app
docker rm flask-app
```

### Kubernetes å·¥ä½œæµç¨‹

```bash
# 1. å‡†å¤‡é•œåƒï¼ˆæœ¬åœ°å¼€å‘ï¼‰
minikube image load flask-app:latest

# 2. éƒ¨ç½²åº”ç”¨
kubectl apply -f k8s/deployment.yaml
kubectl apply -f k8s/service.yaml

# 3. ç­‰å¾… Pod å°±ç»ª
kubectl wait --for=condition=ready pod -l app=flask-app --timeout=300s

# 4. è®¿é—®åº”ç”¨
minikube service flask-app-service

# 5. æ‰©å±•åº”ç”¨
kubectl scale deployment flask-app --replicas=5

# 6. æ›´æ–°åº”ç”¨
kubectl set image deployment/flask-app flask-app=flask-app:v2.0

# 7. æ¸…ç†
kubectl delete -f k8s/
```

---

## ğŸ”— Docker å’Œ Kubernetes çš„å…³ç³»

### æ ¸å¿ƒå…³ç³»

**Docker** å’Œ **Kubernetes** æ˜¯äº’è¡¥çš„æŠ€æœ¯ï¼Œå®ƒä»¬è§£å†³ä¸åŒå±‚é¢çš„é—®é¢˜ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Kubernetes (K8s)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  å®¹å™¨ç¼–æ’å¹³å° - ç®¡ç†ã€è°ƒåº¦ã€æ‰©å±•å®¹å™¨é›†ç¾¤            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â†“ ä½¿ç”¨                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Docker å®¹å™¨                            â”‚  â”‚
â”‚  â”‚  å®¹å™¨è¿è¡Œæ—¶ - æ‰“åŒ…ã€è¿è¡Œåº”ç”¨ç¨‹åº                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦ç»†è¯´æ˜

#### 1. **Dockerï¼šå®¹å™¨åŒ–æŠ€æœ¯**

**Docker è´Ÿè´£ï¼š**
- âœ… **æ‰“åŒ…åº”ç”¨**ï¼šå°†åº”ç”¨åŠå…¶ä¾èµ–æ‰“åŒ…æˆé•œåƒ
- âœ… **è¿è¡Œå®¹å™¨**ï¼šåœ¨å•ä¸ªä¸»æœºä¸Šè¿è¡Œå®¹å™¨
- âœ… **éš”ç¦»ç¯å¢ƒ**ï¼šæä¾›åº”ç”¨è¿è¡Œæ‰€éœ€çš„éš”ç¦»ç¯å¢ƒ
- âœ… **ç®€åŒ–éƒ¨ç½²**ï¼šè§£å†³"åœ¨æˆ‘æœºå™¨ä¸Šèƒ½è·‘"çš„é—®é¢˜

**Docker è§£å†³çš„é—®é¢˜ï¼š**
```
é—®é¢˜ï¼šåº”ç”¨åœ¨ä¸åŒç¯å¢ƒè¡¨ç°ä¸ä¸€è‡´
è§£å†³ï¼šé€šè¿‡å®¹å™¨åŒ–å®ç°"ä¸€æ¬¡æ„å»ºï¼Œåˆ°å¤„è¿è¡Œ"
```

#### 2. **Kubernetesï¼šå®¹å™¨ç¼–æ’å¹³å°**

**Kubernetes è´Ÿè´£ï¼š**
- âœ… **ç®¡ç†å®¹å™¨é›†ç¾¤**ï¼šåœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šç®¡ç†å®¹å™¨
- âœ… **è‡ªåŠ¨è°ƒåº¦**ï¼šå†³å®šå®¹å™¨åœ¨å“ªä¸ªèŠ‚ç‚¹è¿è¡Œ
- âœ… **è‡ªåŠ¨æ‰©å±•**ï¼šæ ¹æ®è´Ÿè½½è‡ªåŠ¨å¢åŠ /å‡å°‘å®¹å™¨æ•°é‡
- âœ… **æœåŠ¡å‘ç°**ï¼šè‡ªåŠ¨ç®¡ç†æœåŠ¡ä¹‹é—´çš„ç½‘ç»œè¿æ¥
- âœ… **æ»šåŠ¨æ›´æ–°**ï¼šé›¶åœæœºæ›´æ–°åº”ç”¨
- âœ… **æ•…éšœæ¢å¤**ï¼šå®¹å™¨å´©æºƒæ—¶è‡ªåŠ¨é‡å¯

**Kubernetes è§£å†³çš„é—®é¢˜ï¼š**
```
é—®é¢˜ï¼šå¦‚ä½•ç®¡ç†æˆç™¾ä¸Šåƒä¸ªå®¹å™¨ï¼Ÿ
è§£å†³ï¼šé€šè¿‡ç¼–æ’å¹³å°è‡ªåŠ¨åŒ–ç®¡ç†å®¹å™¨é›†ç¾¤
```

### ç±»æ¯”ç†è§£

| ç±»æ¯” | Docker | Kubernetes |
|------|--------|------------|
| **å»ºç­‘è¡Œä¸š** | ç –å—ï¼ˆå®¹å™¨ï¼‰ | å»ºç­‘å·¥åœ°ï¼ˆé›†ç¾¤ç®¡ç†ï¼‰ |
| **è¿è¾“è¡Œä¸š** | é›†è£…ç®±ï¼ˆå®¹å™¨ï¼‰ | æ¸¯å£è°ƒåº¦ç³»ç»Ÿï¼ˆç¼–æ’ï¼‰ |
| **é¤å…** | èœå“ï¼ˆå®¹å™¨ï¼‰ | é¤å…ç®¡ç†ç³»ç»Ÿï¼ˆè°ƒåº¦ã€æ‰©å±•ï¼‰ |

### å·¥ä½œæµç¨‹å…³ç³»

```
1. å¼€å‘é˜¶æ®µ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç¼–å†™åº”ç”¨ä»£ç  â”‚
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç¼–å†™ Dockerfile â”‚ â† Docker è´Ÿè´£
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ„å»º Docker é•œåƒ â”‚ â† Docker è´Ÿè´£
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
2. éƒ¨ç½²é˜¶æ®µ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ¨é€åˆ°é•œåƒä»“åº“ â”‚ â† Docker è´Ÿè´£
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ åˆ›å»º K8s é…ç½® â”‚ â† Kubernetes è´Ÿè´£
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ éƒ¨ç½²åˆ° K8s é›†ç¾¤ â”‚ â† Kubernetes è´Ÿè´£
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
3. è¿è¡Œé˜¶æ®µ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ K8s æ‹‰å–é•œåƒ â”‚ â† Kubernetes ä½¿ç”¨ Docker é•œåƒ
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ åˆ›å»º Pod (å®¹å™¨) â”‚ â† Kubernetes ä½¿ç”¨ Docker è¿è¡Œå®¹å™¨
   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ç®¡ç†ã€ç›‘æ§ã€æ‰©å±• â”‚ â† Kubernetes è´Ÿè´£
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®é™…ä¾‹å­

**åœºæ™¯ï¼šéƒ¨ç½²ä¸€ä¸ª Web åº”ç”¨**

#### åªç”¨ Dockerï¼š
```bash
# å•æœºéƒ¨ç½²
docker run -d -p 5000:5000 flask-app

# é—®é¢˜ï¼š
# âŒ åªèƒ½åœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œ
# âŒ éœ€è¦æ‰‹åŠ¨ç®¡ç†å¤šä¸ªå®¹å™¨
# âŒ å®¹å™¨å´©æºƒéœ€è¦æ‰‹åŠ¨é‡å¯
# âŒ æ‰©å±•éœ€è¦æ‰‹åŠ¨æ“ä½œ
# âŒ è´Ÿè½½å‡è¡¡éœ€è¦é¢å¤–é…ç½®
```

#### Docker + Kubernetesï¼š
```yaml
# Kubernetes é…ç½®
apiVersion: apps/v1
kind: Deployment
spec:
  replicas: 5  # è‡ªåŠ¨è¿è¡Œ 5 ä¸ªå®¹å™¨
  # Kubernetes ä¼šï¼š
  # âœ… è‡ªåŠ¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šåˆ†å¸ƒå®¹å™¨
  # âœ… è‡ªåŠ¨é‡å¯å´©æºƒçš„å®¹å™¨
  # âœ… è‡ªåŠ¨è´Ÿè½½å‡è¡¡
  # âœ… å¯ä»¥è½»æ¾æ‰©å±•åˆ° 100 ä¸ªå®¹å™¨
```

### å…³é”®åŒºåˆ«æ€»ç»“

| ç‰¹æ€§ | Docker | Kubernetes |
|------|--------|------------|
| **å®šä½** | å®¹å™¨åŒ–å·¥å…· | å®¹å™¨ç¼–æ’å¹³å° |
| **èŒƒå›´** | å•æœº/å°‘æ•°å®¹å™¨ | é›†ç¾¤/å¤§é‡å®¹å™¨ |
| **åŠŸèƒ½** | æ‰“åŒ…ã€è¿è¡Œ | è°ƒåº¦ã€ç®¡ç†ã€æ‰©å±• |
| **å¤æ‚åº¦** | ç®€å• | å¤æ‚ |
| **é€‚ç”¨åœºæ™¯** | å¼€å‘ã€å°è§„æ¨¡éƒ¨ç½² | ç”Ÿäº§ã€å¤§è§„æ¨¡éƒ¨ç½² |

### ä¸ºä»€ä¹ˆéœ€è¦ä¸¤è€…ï¼Ÿ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åªç”¨ Dockerï¼š                                 â”‚
â”‚ â€¢ é€‚åˆï¼šå¼€å‘ã€æµ‹è¯•ã€å°è§„æ¨¡åº”ç”¨                 â”‚
â”‚ â€¢ é™åˆ¶ï¼šéš¾ä»¥ç®¡ç†å¤§è§„æ¨¡å®¹å™¨é›†ç¾¤                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Docker + Kubernetesï¼š                        â”‚
â”‚ â€¢ Dockerï¼šæä¾›å®¹å™¨åŒ–èƒ½åŠ›                      â”‚
â”‚ â€¢ Kubernetesï¼šæä¾›é›†ç¾¤ç®¡ç†èƒ½åŠ›                 â”‚
â”‚ â€¢ ç»“æœï¼šå®Œæ•´çš„å®¹å™¨åŒ–è§£å†³æ–¹æ¡ˆ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆå…³ç³»

```
åº”ç”¨å±‚
  â†“
Kubernetes (ç¼–æ’å±‚)
  â†“
Docker (å®¹å™¨è¿è¡Œæ—¶å±‚)
  â†“
æ“ä½œç³»ç»Ÿå±‚
```

**æ³¨æ„ï¼š** Kubernetes ä¸ä»…æ”¯æŒ Dockerï¼Œè¿˜æ”¯æŒå…¶ä»–å®¹å™¨è¿è¡Œæ—¶ï¼š
- containerdï¼ˆDocker çš„åº•å±‚è¿è¡Œæ—¶ï¼‰
- CRI-O
- å…¶ä»–ç¬¦åˆ CRIï¼ˆContainer Runtime Interfaceï¼‰æ ‡å‡†çš„è¿è¡Œæ—¶

### å­¦ä¹ è·¯å¾„å»ºè®®

1. **å…ˆå­¦ Docker**
   - ç†è§£å®¹å™¨åŒ–æ¦‚å¿µ
   - å­¦ä¼šæ„å»ºé•œåƒå’Œè¿è¡Œå®¹å™¨
   - æŒæ¡ Docker Compose

2. **å†å­¦ Kubernetes**
   - ç†è§£å®¹å™¨ç¼–æ’æ¦‚å¿µ
   - å­¦ä¼šéƒ¨ç½²åº”ç”¨åˆ° K8s
   - æŒæ¡ Podã€Deploymentã€Service ç­‰æ¦‚å¿µ

3. **ä¸¤è€…ç»“åˆ**
   - ç”¨ Docker æ„å»ºé•œåƒ
   - ç”¨ Kubernetes ç®¡ç†å®¹å™¨é›†ç¾¤

---

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µè§£é‡Š

### Docker æ¦‚å¿µ

1. **é•œåƒï¼ˆImageï¼‰**: åªè¯»æ¨¡æ¿ï¼Œç”¨äºåˆ›å»ºå®¹å™¨
2. **å®¹å™¨ï¼ˆContainerï¼‰**: é•œåƒçš„è¿è¡Œå®ä¾‹
3. **Dockerfile**: ç”¨äºæ„å»ºé•œåƒçš„æŒ‡ä»¤æ–‡ä»¶
4. **Docker Compose**: ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨åº”ç”¨çš„å·¥å…·

### Kubernetes æ¦‚å¿µ

1. **Pod**: æœ€å°çš„éƒ¨ç½²å•å…ƒï¼ŒåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨
2. **Deployment**: ç®¡ç† Pod çš„å‰¯æœ¬å’Œæ›´æ–°
3. **Service**: ä¸º Pod æä¾›ç¨³å®šçš„ç½‘ç»œè®¿é—®
4. **Ingress**: æä¾› HTTP/HTTPS è·¯ç”±åˆ° Service
5. **ReplicaSet**: ç¡®ä¿æŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬è¿è¡Œ
6. **Namespace**: ç”¨äºèµ„æºéš”ç¦»å’Œç»„ç»‡çš„è™šæ‹Ÿé›†ç¾¤

---

## ğŸ¯ å®è·µç»ƒä¹ 

1. **ä¿®æ”¹åº”ç”¨ä»£ç **ï¼Œæ·»åŠ æ–°ç«¯ç‚¹ï¼Œé‡æ–°æ„å»ºå’Œéƒ¨ç½²
2. **è°ƒæ•´å‰¯æœ¬æ•°**ï¼Œè§‚å¯Ÿ Kubernetes å¦‚ä½•è‡ªåŠ¨åˆ›å»º/åˆ é™¤ Pod
3. **æ¨¡æ‹Ÿ Pod æ•…éšœ**ï¼Œåˆ é™¤ä¸€ä¸ª Podï¼Œè§‚å¯Ÿè‡ªåŠ¨æ¢å¤
4. **é…ç½®èµ„æºé™åˆ¶**ï¼Œè§‚å¯Ÿèµ„æºä¸è¶³æ—¶çš„è¡Œä¸º
5. **ä½¿ç”¨ ConfigMap** å­˜å‚¨é…ç½®ï¼Œè€Œä¸æ˜¯ç¡¬ç¼–ç ç¯å¢ƒå˜é‡
6. **æ·»åŠ å¥åº·æ£€æŸ¥**ï¼Œè§‚å¯Ÿä¸å¥åº· Pod çš„å¤„ç†

---

## ğŸ› å¸¸è§é—®é¢˜

### Docker é—®é¢˜

**Q: ç«¯å£å·²è¢«å ç”¨**
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :5000
# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
docker run -p 5001:5000 flask-app:latest
```

**Q: é•œåƒæ„å»ºå¤±è´¥**
```bash
# æŸ¥çœ‹è¯¦ç»†æ„å»ºæ—¥å¿—
docker build --no-cache -t flask-app:latest .
```

### Kubernetes é—®é¢˜

**Q: Pod ä¸€ç›´å¤„äº Pending çŠ¶æ€**
```bash
# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod <pod-name>
# å¸¸è§åŸå› ï¼šèµ„æºä¸è¶³ã€èŠ‚ç‚¹é€‰æ‹©å™¨ä¸åŒ¹é…
```

**Q: Pod ä¸€ç›´å¤„äº CrashLoopBackOff**
```bash
# æŸ¥çœ‹æ—¥å¿—
kubectl logs <pod-name>
# æ£€æŸ¥åº”ç”¨ä»£ç å’Œé…ç½®
```

**Q: Service æ— æ³•è®¿é—®**
```bash
# æ£€æŸ¥ Service çš„ selector æ˜¯å¦åŒ¹é… Pod çš„ labels
kubectl get pods --show-labels
kubectl describe service flask-app-service
```

---

## ğŸ“– è¿›ä¸€æ­¥å­¦ä¹ 

- [Docker å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/)
- [Kubernetes å®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)
- [Kubernetes äº¤äº’å¼æ•™ç¨‹](https://kubernetes.io/docs/tutorials/)
- [Docker Compose æ–‡æ¡£](https://docs.docker.com/compose/)

---

## ğŸ‰ æ€»ç»“

é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ï¼Œä½ åº”è¯¥å­¦ä¼šäº†ï¼š

âœ… å¦‚ä½•æ„å»º Docker é•œåƒ  
âœ… å¦‚ä½•è¿è¡Œå’Œç®¡ç† Docker å®¹å™¨  
âœ… å¦‚ä½•ä½¿ç”¨ Docker Compose  
âœ… å¦‚ä½•éƒ¨ç½²åº”ç”¨åˆ° Kubernetes  
âœ… å¦‚ä½•é…ç½® Service å’Œ Ingress  
âœ… å¦‚ä½•ç›‘æ§å’Œè°ƒè¯•å®¹å™¨åŒ–åº”ç”¨  

Happy Learning! ğŸš€

